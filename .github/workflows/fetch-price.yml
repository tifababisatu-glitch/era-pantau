name: Fetch Eraspace Price

on:
  schedule:
    - cron: "0 * * * *"   # setiap 1 jam
  workflow_dispatch:

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # --- Install dependency sistem untuk Chromium ---
      - name: Install System Packages
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libnss3 libatk1.0-0 libatk-bridge2.0-0 libdrm2 libxkbcommon0 \
            libxcomposite1 libxdamage1 libxrandr2 libgbm1 \
            libxshmfence1 libasound2t64 xvfb || true

      # --- Install Node.js packages (Playwright + fetch) ---
      - name: Install Node Packages
        run: |
          npm install playwright node-fetch
          npx playwright install chromium
          sleep 3

      # --- Jalankan fetch.js dengan headless Chromium ---
      - name: Jalankan Fetch Script (Eraspace)
        run: |
          xvfb-run --auto-servernum node fetch.js

      # --- Upload screenshot jika halaman gagal dimuat ---
      - name: Upload screenshot bila ada
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: page-debug
          path: page.png
          if-no-files-found: ignore
